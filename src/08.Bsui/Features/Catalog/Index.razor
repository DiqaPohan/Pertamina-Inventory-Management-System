@page "/Catalog"

@using Pertamina.SolutionTemplate.Bsui.Services.AppInfo
@attribute [Authorize]
@inject IOptions<AppInfoOptions> _appInfoOptions
@using Pertamina.SolutionTemplate.Shared.Data.Queries.GetSingleData
@using Syncfusion.Blazor
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Calendars
@using Syncfusion.Blazor.Charts
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Popups
@inject NavigationManager NavigationManager
<style>
    #control-container {
        padding: 0px !important;
    }

    #templateWrap img {
        border-radius: 0px;
        width: 24px;
        padding: 4px;
        height: 24px;
    }

    #templateWrap .des {
        float: right;
        padding: 2px;
        line-height: 20px;
        text-align: center;
    }

    #waterfall_Series_0_Connector_ {
        stroke-dasharray: 4px 4px;
        stroke-linejoin: round;
        stroke-linecap: round;
        -webkit-animation: dash 1s linear infinite;
        animation: dash 1s linear infinite;
    }

    #category:hover {
        cursor: pointer;
    }

    path[id^=drilldown_Series_0_Point_] {
        @CSS_Cursor
    }

    @@-webkit-keyframes dash {
        100% {
            stroke-dashoffset: -20px;
        }
    }

    @@keyframes dash {
        100% {
            stroke-dashoffset: -20px;
        }
    }
</style>
<style>
    a, a:hover, .highcontrast #dialog a, .highcontrast #dialog a:hover {
        color: inherit;
        text-decoration: none;
    }

    .fabric #target .e-dialog {
        height: 306px;
    }

    .material #target .e-dialog {
        height: 270px;
    }

    .bootstrap4 #target .e-dialog {
        height: 305px;
    }

    #target .e-dialog {
        height: 320px;
    }

    #target {
        height: 500px;
    }

    .e-dialog .e-dlg-header-content + .e-dlg-content {
        padding-bottom: 0;
    }
</style>
<BrowserTabTitle>OverView</BrowserTabTitle>
<MudBreadcrumbs Items="_breadcrumbItems"></MudBreadcrumbs>
<ErrorViewer Error="_error" />
<LoadingLinear IsVisible="_isLoading" />
<AuthorizeView Context="authorizeContext">
    <Authorized>
        @if (@authorizeContext.User.GetCompanyCode() == "2186")
        {
            @if (!@_isLoading)
            {
                <MudContainer MaxWidth="MaxWidth.False">
                    <MudGrid>
                        <MudItem md="12"
                                 sm="12"
                                 xs="12">
                            <MudCard Outlined="true" Square="true" Class="border-solid border-2">
                                <MudCardHeader Style="background-color: #1E88E5; color: var(--mud-palette-primary-text);">
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.body1" Align="Align.Center">
                                            Total Aplikasi Seluruh Area
                                            @_totalapps
                                            <MudIconButton Icon="@Icons.Material.Filled.Search" @onclick="@(() => OnShowDialogDetails("totalaps"))" Variant="MudBlazor.Variant.Filled" Color="MudBlazor.Color.Primary" Size="MudBlazor.Size.Small" />
                                        </MudText>
                                    </CardHeaderContent>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudGrid>
                                        <MudItem xs="4">
                                            <MudPaper Class="pa-4"
                                                      Elevation="2"
                                                      Style="height: 100px;background-color:blue;color:white;">
                                                <div class="align-center d-flex"
                                                     style="height: 100%">
                                                    <div class="d-flex flex-column">
                                                        <MudText Class="light-bold mb-5">KPI KANTOR PUSAT</MudText>
                                                        <MudText Class="mb-4 strong-bold"
                                                                 Typo="Typo.h4">
                                                            @_totalappskpipusat
                                                            <MudIconButton Icon="@Icons.Material.Filled.Search" @onclick="@(() => OnShowDialogDetails("totalapskpi"))" Variant="MudBlazor.Variant.Filled" Color="MudBlazor.Color.Primary" Size="MudBlazor.Size.Small" />

                                                        </MudText>
                                                    </div>
                                                </div>
                                            </MudPaper>
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudPaper Class="pa-4"
                                                      Elevation="2"
                                                      Style="height: 100px;background-color:red;color:white;">
                                                <div class="align-center d-flex"
                                                     style="height: 100%">
                                                    <div class="d-flex flex-column">
                                                        <MudText Class="light-bold mb-5">KPI REFINERY UNIT</MudText>
                                                        <MudText Class="mb-4 strong-bold"
                                                                 Typo="Typo.h4">
                                                            @_totalappskpiru
                                                            <MudIconButton Icon="@Icons.Material.Filled.Search" @onclick="@(() => OnShowDialogDetails("totalapru"))" Variant="MudBlazor.Variant.Filled" Color="MudBlazor.Color.Primary" Size="MudBlazor.Size.Small" />

                                                        </MudText>
                                                    </div>
                                                </div>
                                            </MudPaper>

                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudPaper Class="pa-4"
                                                      Elevation="2"
                                                      Style="height: 100px; background-color:green; color:white;">
                                                <div class="align-center d-flex"
                                                     style="height: 100%">
                                                    <div class="d-flex flex-column">
                                                        <MudText Class="light-bold mb-5">HOLDING</MudText>
                                                        <MudText Class="mb-4 strong-bold"
                                                                 Typo="Typo.h4">
                                                            @_totalappsholding
                                                            <MudIconButton Icon="@Icons.Material.Filled.Search" @onclick="@(() => OnShowDialogDetails("totalapholding"))" Variant="MudBlazor.Variant.Filled" Color="MudBlazor.Color.Primary" Size="MudBlazor.Size.Small" />

                                                        </MudText>
                                                    </div>
                                                </div>
                                            </MudPaper>

                                        </MudItem>

                                    </MudGrid>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>
                        <MudSpacer></MudSpacer>
                        @if (@_listByTypes.Any())
                        {
                            <MudItem md="12"
                                     sm="12"
                                     xs="12">
                                <MudCard Outlined="true" Square="true" Class="border-solid border-2">
                                    <MudCardHeader Style="background-color: #1E88E5; color: var(--mud-palette-primary-text);">
                                        <CardHeaderContent>
                                            <MudText Typo="Typo.body1" Align="Align.Center">
                                                Total Aplikasi Seluruh Type
                                                @_totalapps
                                                <MudIconButton Icon="@Icons.Material.Filled.Search" @onclick="@(() => OnShowDialogDetails("totalaps"))" Variant="MudBlazor.Variant.Filled" Color="MudBlazor.Color.Primary" Size="MudBlazor.Size.Small" />
                                            </MudText>
                                        </CardHeaderContent>
                                    </MudCardHeader>
                                    <MudCardContent>
                                        <MudGrid>
                                            @foreach (var item in _listByTypes)
                                            {
                                                <MudItem xs="3">
                                                    <MudPaper Class="pa-3"
                                                              Elevation="2"
                                                              Style="background-color:gray;color:white;">
                                                        <div class="align-center d-flex"
                                                             style="height: 100%">
                                                            <div class="d-flex flex-column">
                                                                <MudText Class="light-bold mb-5">@item.Text</MudText>
                                                                <MudText Class="mb-4 strong-bold"
                                                                         Typo="Typo.h4">
                                                                    @item.Number
                                                                    <MudIconButton Icon="@Icons.Material.Filled.Search" @onclick="@(() => OnShowDialogDetails(@item.Text))" Variant="MudBlazor.Variant.Filled" Color="MudBlazor.Color.Primary" Size="MudBlazor.Size.Small" />
                                                                </MudText>
                                                            </div>
                                                        </div>
                                                    </MudPaper>
                                                </MudItem>
                                            }
                                        </MudGrid>
                                    </MudCardContent>
                                </MudCard>
                            </MudItem>
                            <MudSpacer></MudSpacer>
                        }

                        <MudItem md="12"
                                 sm="12"
                                 xs="12">
                            <MudCard Outlined="true" Square="true" Class="border-solid border-2">
                                <MudCardHeader Style="background-color: #1E88E5; color: var(--mud-palette-primary-text);">
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.body1" Align="Align.Center">
                                            Chart Data
                                        </MudText>
                                    </CardHeaderContent>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudGrid>
                                        <MudItem xs="12">
                                            <MudPaper Class="pa-6"
                                                      Elevation="2">
                                                <div class="align-center d-flex"
                                                     style="height: 60px">
                                                    <MudText Typo="Typo.h6">
                                                        Status Aplikasi
                                                    </MudText>
                                                </div>
                                                <SfAccumulationChart EnableAnimation="true" EnableSmartLabels="true">
                                                    <AccumulationChartEvents OnPointClick="AccPointClick_Status"></AccumulationChartEvents>
                                                    <AccumulationChartLegendSettings Visible="true" EnableHighlight="true" Position="LegendPosition.Bottom">
                                                        <AccumulationChartLegendBorder Color="red" Width="1"></AccumulationChartLegendBorder>
                                                        <AccumulationChartLegendFont Size="20px" Color="Black">
                                                        </AccumulationChartLegendFont>
                                                    </AccumulationChartLegendSettings>

                                                    <AccumulationChartSeriesCollection>
                                                        <AccumulationChartSeries Palettes="@_palettes" DataSource="@PieChartPoints" XName="XValue" YName="YValue"
                                                                                 InnerRadius="20%" Radius="@Radius">
                                                            <AccumulationDataLabelSettings Name="DataLabelMappingName" TextWrap="@Wrap" Visible="true" EnableRotation="@Rotation" Position="@LabelPosition">
                                                                <AccumulationChartDataLabelFont Color="#ffffff" FontWeight="600" Size=@Size></AccumulationChartDataLabelFont>
                                                                <AccumulationChartConnector Type="ConnectorType.Curve" Length=@ConnectorLength></AccumulationChartConnector>
                                                            </AccumulationDataLabelSettings>
                                                        </AccumulationChartSeries>

                                                    </AccumulationChartSeriesCollection>
                                                    <AccumulationChartTooltipSettings Enable="true"></AccumulationChartTooltipSettings>
                                                </SfAccumulationChart>

                                            </MudPaper>

                                        </MudItem>
                                        @*       <MudItem xs="6">
                                <MudPaper Class="pa-6"
                                Elevation="2">
                                <div class="d-flex align-center"
                                style="height: 60px">
                                <MudText Typo="Typo.h6">
                                Status Aplikasi Dalam 6 Bulan
                                </MudText>
                                </div>
                                <div class="control-section" align='center'>
                                <SfChart Width="@Width">
                                <ChartArea><ChartAreaBorder Width="0"></ChartAreaBorder></ChartArea>
                                <ChartEvents OnPointClick="AccPointClick_Phase" OnAxisLabelRender="AxisLabel"></ChartEvents>
                                <ChartPrimaryXAxis ValueType="Syncfusion.Blazor.Charts.ValueType.Category" Interval="1" LabelIntersectAction="LabelIntersectAction.Rotate45">
                                <ChartAxisMajorGridLines Width="0"></ChartAxisMajorGridLines>
                                <ChartAxisMinorGridLines Width="0"></ChartAxisMinorGridLines>
                                <ChartAxisMajorTickLines Width="0"></ChartAxisMajorTickLines>
                                <ChartAxisMinorTickLines Width="0"></ChartAxisMinorTickLines>
                                <ChartAxisLineStyle Width="0"></ChartAxisLineStyle>
                                </ChartPrimaryXAxis>
                                <ChartPrimaryYAxis>
                                <ChartAxisMinorGridLines Width="1"></ChartAxisMinorGridLines>
                                <ChartAxisMajorTickLines Width="0"></ChartAxisMajorTickLines>
                                <ChartAxisMinorTickLines Width="0"></ChartAxisMinorTickLines>
                                <ChartAxisLineStyle Width="0"></ChartAxisLineStyle>
                                </ChartPrimaryYAxis>
                                <ChartSeriesCollection>
                                <ChartSeries ColumnWidth="0.5" Fill="green" DataSource="@ChartStackedPoints" XName="Year" YName="Active" Width="2" Name="Aktif" Type="ChartSeriesType.StackingColumn">
                                <ChartSeriesAnimation Enable="false"></ChartSeriesAnimation>
                                <ChartMarker Visible="true" Height="10" Width="10" Shape="ChartShape.Rectangle">
                                <ChartDataLabel Visible="true">
                                <ChildContent>
                                <ChartDataLabelMargin Top="70"></ChartDataLabelMargin>
                                </ChildContent>
                                <Template>
                                @{
                                var data = context as ChartDataPointInfo;
                                var foundata = @ChartStackedPoints.Where(xx => xx.Year.ToString() == data.X.ToString()).FirstOrDefault();
                                if (foundata != null)
                                {
                                if (foundata.ChartType == "active")
                                {
                                <table>
                                <tr>
                                <td align="center" style="background-color: #C1272D; font-size: 14px; color: #E7C554; font-weight: bold; padding: 5px">Total :</td>
                                <td align="center" style="background-color: #C1272D; font-size: 14px; color: whitesmoke; font-weight: bold; padding: 5px"> @foundata.Total</td>
                                </tr>
                                </table>
                                }
                                }

                                }
                                </Template>
                                </ChartDataLabel>
                                </ChartMarker>
                                </ChartSeries>
                                <ChartSeries Visible="true" ColumnWidth="0.5" Fill="#26a69a" DataSource="@ChartStackedPoints" XName="Year" YName="Rationalize" Width="2" Name="Rasionalisasi" Type="ChartSeriesType.StackingColumn">
                                <ChartSeriesAnimation Enable="false"></ChartSeriesAnimation>
                                <ChartMarker Visible="true" Height="10" Width="10" Shape="ChartShape.Rectangle">
                                <ChartDataLabel Visible="true">
                                <ChildContent>
                                <ChartDataLabelMargin Top="70"></ChartDataLabelMargin>
                                </ChildContent>
                                <Template>
                                @{
                                var data = context as ChartDataPointInfo;
                                var foundata = @ChartStackedPoints.Where(xx => xx.Year.ToString() == data.X.ToString()).FirstOrDefault();
                                if (foundata != null)
                                {
                                if (foundata.ChartType == "rationalize")
                                {
                                <table>
                                <tr>
                                <td align="center" style="background-color: #C1272D; font-size: 14px; color: #E7C554; font-weight: bold; padding: 5px">Total :</td>
                                <td align="center" style="background-color: #C1272D; font-size: 14px; color: whitesmoke; font-weight: bold; padding: 5px"> @foundata.Total</td>
                                </tr>
                                </table>
                                }
                                }
                                }
                                </Template>
                                </ChartDataLabel>
                                </ChartMarker>
                                </ChartSeries>
                                <ChartSeries Visible="true" ColumnWidth="0.5" Fill="red" DataSource="@ChartStackedPoints" XName="Year" YName="NonActive" Width="2" Name="Tidak Aktif" Type="ChartSeriesType.StackingColumn">
                                <ChartSeriesAnimation Enable="false"></ChartSeriesAnimation>
                                <ChartMarker Visible="true" Height="10" Width="10" Shape="ChartShape.Rectangle">
                                <ChartDataLabel Visible="true">
                                <ChildContent>
                                <ChartDataLabelMargin Top="70"></ChartDataLabelMargin>
                                </ChildContent>
                                <Template>
                                @{
                                var data = context as ChartDataPointInfo;
                                var foundata = @ChartStackedPoints.Where(xx => xx.Year.ToString() == data.X.ToString()).FirstOrDefault();
                                if (foundata != null)
                                {
                                if (foundata.ChartType == "non active")
                                {
                                <table>
                                <tr>
                                <td align="center" style="background-color: #C1272D; font-size: 14px; color: #E7C554; font-weight: bold; padding: 5px">Total :</td>
                                <td align="center" style="background-color: #C1272D; font-size: 14px; color: whitesmoke; font-weight: bold; padding: 5px"> @foundata.Total</td>
                                </tr>
                                </table>
                                }
                                }
                                }
                                </Template>
                                </ChartDataLabel>
                                </ChartMarker>
                                </ChartSeries>
                                </ChartSeriesCollection>
                                <ChartTooltipSettings Enable="true"></ChartTooltipSettings>
                                <ChartLegendSettings Visible="true" EnableHighlight="true">
                                <ChartLegendTextStyle Size="20px" Color="Black" FontWeight="strong"></ChartLegendTextStyle>
                                <ChartLegendBorder Color="red" Width="1"></ChartLegendBorder>
                                </ChartLegendSettings>
                                </SfChart>
                                </div>
                                </MudPaper>

                                </MudItem>
                                *@
                                    </MudGrid>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>
                        <SfDialog Target="#target" Width="700px" IsModal="true" ShowCloseIcon="true" @bind-Visible="Visibility">
                            <DialogTemplates>
                                <Header>@_strHeadDialog</Header>
                                <Content>
                                    <SfGrid ID="Grid" @ref="_blazorDataGridNonHistorical" DataSource="@_dataCountTemporary" Toolbar="@(new List<string>() { "Search" })" AllowExcelExport="true" AllowFiltering="true" AllowPaging="true" AllowTextWrap="true" hidden="@Visibilitygridnonhistrocial">
                                        <GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.CheckBox"></GridFilterSettings>
                                        <GridEvents TValue="GetSingleData"></GridEvents>
                                        <GridPageSettings PageSize=6></GridPageSettings>
                                        <GridColumns>
                                            <GridColumn Field="@nameof(GetSingleData.Code_Apps)" AllowSearching="true" AllowFiltering="false" HeaderText="Application Code" Width="120"></GridColumn>
                                            <GridColumn Field="@nameof(GetSingleData.Application_Area)" AllowSearching="false" HeaderText="Application Area" Width="150"></GridColumn>
                                            <GridColumn Field="@nameof(GetSingleData.Application_Name)" AllowSearching="true" AllowFiltering="true" HeaderText="Application Name" Width="150"></GridColumn>
                                            <GridColumn Field="@nameof(GetSingleData.Application_Status)" AllowSearching="false" HeaderText="Application Status" Width="140"></GridColumn>
                                        </GridColumns>
                                    </SfGrid>
                                    @* <SfGrid ID="Grid" @ref="_blazorDataGridHistorical" DataSource="@_lphaseschild" Toolbar="@(new List<string>() { "Search" })" AllowExcelExport="true" AllowFiltering="true" AllowPaging="true" AllowTextWrap="true" hidden="@Visibilitygridhistrocial">
                            <GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.CheckBox"></GridFilterSettings>
                            <GridEvents TValue="ListByPhase"></GridEvents>
                            <GridPageSettings PageSize=6></GridPageSettings>
                            <GridColumns>
                            <GridColumn Field="@nameof(ListByPhase.CodeApp)" AllowSearching="true" AllowFiltering="false" HeaderText="Application Code" Width="120"></GridColumn>
                            <GridColumn Field="@nameof(ListByPhase.AreaApp)" AllowSearching="false" HeaderText="Application Area" Width="150"></GridColumn>
                            <GridColumn Field="@nameof(ListByPhase.NameApp)" AllowSearching="true" AllowFiltering="true" HeaderText="Application Name" Width="150"></GridColumn>
                            <GridColumn Field="@nameof(ListByPhase.PhaseApp)" AllowSearching="false" HeaderText="Application Status" Width="140"></GridColumn>
                            </GridColumns>
                            </SfGrid> *@
                                </Content>
                            </DialogTemplates>
                            <DialogEvents OnOpen="@DialogOpen" Closed="@DialogClose"></DialogEvents>
                            <DialogButtons>

                            </DialogButtons>
                        </SfDialog>
                    </MudGrid>

                </MudContainer>
            }
        }
        else
        {
            <div class="d-flex justify-space-around mt-16">
                <div>
                    <MudText Typo="Typo.h2">Kode Perusahaan tidak terdaftar</MudText>
                    <MudText Typo="Typo.body1">Aplikasi ini hanya bisa di akses untuk user dari KPI (Kilang Pertamina Indonesia)</MudText>
                </div>
                <div>
                    <img src="img/unauthorized.png" alt="Unauthorized" width="300" />
                </div>
            </div>
        }
    </Authorized>
</AuthorizeView>
